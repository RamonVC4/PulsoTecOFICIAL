<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceder - PULSOTEC</title>
    <link rel="stylesheet" href="../styles/styles_login.css">
</head>
<body class="login-page">
    <main class="login-container">
        
        <header class="return-to-index-header">
            <a href="../index.html">VOLVER A INICIO</a>
        </header>


        <section class="card" role="region" aria-labelledby="login-title">
            <h1 id="login-title" class="card-title">ACCEDER COMO</h1>

            <!-- <form class="login-form" action="login.php" method="post" autocomplete="on" novalidate> -->
            <form class="login-form" autocomplete="on" novalidate>
                <!-- Role switcher (submits with the form) -->
                <div class="role-switch" role="tablist" aria-label="Seleccionar rol">
                    <input type="radio" id="role-autor" name="role" value="autor">
                    <input type="radio" id="role-manager" name="role" value="manager">
                    <input type="radio" id="role-revisor" name="role" value="revisor" checked>

                    <div class="tabs">
                        <label class="tab" for="role-autor" role="tab" aria-controls="tabpanel" aria-selected="false">AUTOR</label>
                        <label class="tab" for="role-manager" role="tab" aria-controls="tabpanel" aria-selected="false">MANAGER</label>
                        <label class="tab" for="role-revisor" role="tab" aria-controls="tabpanel" aria-selected="true">REVISOR</label>
                        <span class="pill" aria-hidden="true"></span>
                    </div>
                </div>

                <div id="tabpanel" class="form-fields" role="tabpanel" tabindex="-1">
                    <div class="field">
                        <label for="correo">Correo</label>
                        <input id="correo" name="correo" type="text" inputmode="text" autocomplete="correo" required placeholder="Ingresa tu correo">
                    </div>

                    <div class="field password-field">
                        <label for="password">Contraseña</label>
                        <div class="password-field_with-icon">

                            <input id="password" name="password" type="password" autocomplete="current-password" required placeholder="Ingresa tu contraseña">

                            <button type="button" class="toggle-password" aria-label="Mostrar u ocultar contraseña" aria-controls="password">
                                <!-- SVG -->
                                <svg class="icon-eye" viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                    <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                        </div>
                        
                    </div>
                </div>

                <div class="actions">
                    <button type="button" class="btn-primary" onclick="goToPage()">ACCEDER</button>
                    <a class="link-ghost" href="./register.html" aria-label="Crear cuenta nueva">NO TENGO UN USUARIO</a>
                </div>
            </form>
        </section>
    </main>

    <footer class="brand-footer" aria-hidden="true">
        <span>P u l s o T e c&nbsp;&nbsp;V e r i f i c a</span>
    </footer>



    
    <script>
    (function () {
        const toggle = document.querySelector('.toggle-password');
        const pwd = document.getElementById('password');
        if (toggle && pwd) {
            toggle.addEventListener('click', function () {
                const reveal = pwd.type === 'password';
                pwd.type = reveal ? 'text' : 'password';
                toggle.classList.toggle('revealed', reveal);
                pwd.focus({ preventScroll: true });
            });
        }
    })();

    async function goToPage() {
        //consigo los datos
        const role = document.querySelector('input[name="role"]:checked')?.value;
        const correo = document.getElementById('correo').value;
        const password = document.getElementById('password').value;

        //hago un fetch a php
        const res = await fetch("../php/login.php", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ correo, password, role }),
            credentials: "same-origin" // para enviar cookies de la sesion
        });

        const data = await res.json();

        if (!data.success) {
            alert("Datos incorrectos, por favor verifique los campos.");
            return;
        }

        console.log(data);
        window.location.href = data.redirect;
    }


    </script>
</body>
</html>

